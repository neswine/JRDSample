(function () {

	angular
		.module('JRDApp')
		.controller('getUpdatesCtrl', [ '$scope', '$http', '$routeParams', 'socketFactory', function($scope, $http, $routeParams, socketFactory) {

			// $scope.tweets = {"created_at":"Mon Oct 23 03:08:27 +0000 2017","id":922298646795710500,"id_str":"922298646795710464","text":"RT @MixedRaita: Virat Kohli's runs and Rahul Gandhi's bots have given similar results last week. #INDvNZ #RahulBotAttack","source":"<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":100472536,"id_str":"100472536","name":"Ramsaâ„¢","screen_name":"ramsa_b","location":"Bikaner Rajasthan India","url":"https://twitter.com/search?q=from:@ramsa_b","description":"Pest control Business | Indian Hindu-Bishnoi ||Tweets about-Politics,Agriculture,Journalism, Spirituality,Devotional,Environment \nðŸ‘‰My Tweets In LikesðŸ‘ˆ","translator_type":"none","protected":false,"verified":false,"followers_count":80494,"friends_count":3204,"listed_count":288,"favourites_count":77170,"statuses_count":391383,"created_at":"Wed Dec 30 11:17:35 +0000 2009","utc_offset":19800,"time_zone":"New Delhi","geo_enabled":true,"lang":"en","contributors_enabled":false,"is_translator":false,"profile_background_color":"B2DFDA","profile_background_image_url":"http://abs.twimg.com/images/themes/theme13/bg.gif","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme13/bg.gif","profile_background_tile":false,"profile_link_color":"93A644","profile_sidebar_border_color":"EEEEEE","profile_sidebar_fill_color":"FFFFFF","profile_text_color":"333333","profile_use_background_image":true,"profile_image_url":"http://pbs.twimg.com/profile_images/921798036975534080/IthtWvm7_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/921798036975534080/IthtWvm7_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/100472536/1483524509","default_profile":false,"default_profile_image":false,"following":null,"follow_request_sent":null,"notifications":null},"geo":null,"coordinates":null,"place":null,"contributors":null,"retweeted_status":{"created_at":"Mon Oct 23 03:04:32 +0000 2017","id":922297661113421800,"id_str":"922297661113421829","text":"Virat Kohli's runs and Rahul Gandhi's bots have given similar results last week. #INDvNZ #RahulBotAttack","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":1077479862,"id_str":"1077479862","name":"Ð¯Ã¸Ã¿","screen_name":"MixedRaita","location":"India","url":null,"description":"Raita Recipe : Italian Milk. Pakistani Tomatoes. Nagpuri Onions. Gujarati Salt. Kashmiri Red Chilli. Dadri Black Pepper. Sahitya Dhaniya.","translator_type":"none","protected":false,"verified":false,"followers_count":10581,"friends_count":871,"listed_count":65,"favourites_count":3621,"statuses_count":32361,"created_at":"Thu Jan 10 19:35:31 +0000 2013","utc_offset":19800,"time_zone":"New Delhi","geo_enabled":false,"lang":"en","contributors_enabled":false,"is_translator":false,"profile_background_color":"000000","profile_background_image_url":"http://abs.twimg.com/images/themes/theme1/bg.png","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme1/bg.png","profile_background_tile":false,"profile_link_color":"1B95E0","profile_sidebar_border_color":"000000","profile_sidebar_fill_color":"000000","profile_text_color":"000000","profile_use_background_image":false,"profile_image_url":"http://pbs.twimg.com/profile_images/886458835409321987/jINyHWSy_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/886458835409321987/jINyHWSy_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/1077479862/1454766015","default_profile":false,"default_profile_image":false,"following":null,"follow_request_sent":null,"notifications":null},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"quote_count":0,"reply_count":0,"retweet_count":1,"favorite_count":1,"entities":{"hashtags":[{"text":"INDvNZ","indices":[81,88]},{"text":"RahulBotAttack","indices":[89,104]}],"urls":[],"user_mentions":[],"symbols":[]},"favorited":false,"retweeted":false,"filter_level":"low","lang":"en"},"is_quote_status":false,"quote_count":0,"reply_count":0,"retweet_count":0,"favorite_count":0,"entities":{"hashtags":[{"text":"INDvNZ","indices":[97,104]},{"text":"RahulBotAttack","indices":[105,120]}],"urls":[],"user_mentions":[{"screen_name":"MixedRaita","name":"Ð¯Ã¸Ã¿","id":1077479862,"id_str":"1077479862","indices":[3,14]}],"symbols":[]},"favorited":false,"retweeted":false,"filter_level":"low","lang":"en","timestamp_ms":"1508728107533"};

			$scope.tweets = []
			socketFactory.connect();
			$http({
			    method: 'POST',
			    url: '/api/getUpdates',
			    data: "filterName=" + ($routeParams.name),
			    headers: {'Content-Type': 'application/x-www-form-urlencoded'}
			}).then(function(data){
				console.log(data);
			}, function(err){

			});

	        socketFactory.on('newTweet', function(data) {
	            console.log(data.data);
	            $scope.tweets.splice(0, 0, data.data);
	            $scope.$apply()
	            // $scope.tweets = {"created_at":"Mon Oct 23 03:08:27 +0000 2017","id":922298646795710500,"id_str":"922298646795710464","text":"RT @MixedRaita: Virat Kohli's runs and Rahul Gandhi's bots have given similar results last week. #INDvNZ #RahulBotAttack","source":"<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":100472536,"id_str":"100472536","name":"Ramsaâ„¢","screen_name":"ramsa_b","location":"Bikaner Rajasthan India","url":"https://twitter.com/search?q=from:@ramsa_b","description":"Pest control Business | Indian Hindu-Bishnoi ||Tweets about-Politics,Agriculture,Journalism, Spirituality,Devotional,Environment \nðŸ‘‰My Tweets In LikesðŸ‘ˆ","translator_type":"none","protected":false,"verified":false,"followers_count":80494,"friends_count":3204,"listed_count":288,"favourites_count":77170,"statuses_count":391383,"created_at":"Wed Dec 30 11:17:35 +0000 2009","utc_offset":19800,"time_zone":"New Delhi","geo_enabled":true,"lang":"en","contributors_enabled":false,"is_translator":false,"profile_background_color":"B2DFDA","profile_background_image_url":"http://abs.twimg.com/images/themes/theme13/bg.gif","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme13/bg.gif","profile_background_tile":false,"profile_link_color":"93A644","profile_sidebar_border_color":"EEEEEE","profile_sidebar_fill_color":"FFFFFF","profile_text_color":"333333","profile_use_background_image":true,"profile_image_url":"http://pbs.twimg.com/profile_images/921798036975534080/IthtWvm7_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/921798036975534080/IthtWvm7_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/100472536/1483524509","default_profile":false,"default_profile_image":false,"following":null,"follow_request_sent":null,"notifications":null},"geo":null,"coordinates":null,"place":null,"contributors":null,"retweeted_status":{"created_at":"Mon Oct 23 03:04:32 +0000 2017","id":922297661113421800,"id_str":"922297661113421829","text":"Virat Kohli's runs and Rahul Gandhi's bots have given similar results last week. #INDvNZ #RahulBotAttack","source":"<a href=\"http://twitter.com\" rel=\"nofollow\">Twitter Web Client</a>","truncated":false,"in_reply_to_status_id":null,"in_reply_to_status_id_str":null,"in_reply_to_user_id":null,"in_reply_to_user_id_str":null,"in_reply_to_screen_name":null,"user":{"id":1077479862,"id_str":"1077479862","name":"Ð¯Ã¸Ã¿","screen_name":"MixedRaita","location":"India","url":null,"description":"Raita Recipe : Italian Milk. Pakistani Tomatoes. Nagpuri Onions. Gujarati Salt. Kashmiri Red Chilli. Dadri Black Pepper. Sahitya Dhaniya.","translator_type":"none","protected":false,"verified":false,"followers_count":10581,"friends_count":871,"listed_count":65,"favourites_count":3621,"statuses_count":32361,"created_at":"Thu Jan 10 19:35:31 +0000 2013","utc_offset":19800,"time_zone":"New Delhi","geo_enabled":false,"lang":"en","contributors_enabled":false,"is_translator":false,"profile_background_color":"000000","profile_background_image_url":"http://abs.twimg.com/images/themes/theme1/bg.png","profile_background_image_url_https":"https://abs.twimg.com/images/themes/theme1/bg.png","profile_background_tile":false,"profile_link_color":"1B95E0","profile_sidebar_border_color":"000000","profile_sidebar_fill_color":"000000","profile_text_color":"000000","profile_use_background_image":false,"profile_image_url":"http://pbs.twimg.com/profile_images/886458835409321987/jINyHWSy_normal.jpg","profile_image_url_https":"https://pbs.twimg.com/profile_images/886458835409321987/jINyHWSy_normal.jpg","profile_banner_url":"https://pbs.twimg.com/profile_banners/1077479862/1454766015","default_profile":false,"default_profile_image":false,"following":null,"follow_request_sent":null,"notifications":null},"geo":null,"coordinates":null,"place":null,"contributors":null,"is_quote_status":false,"quote_count":0,"reply_count":0,"retweet_count":1,"favorite_count":1,"entities":{"hashtags":[{"text":"INDvNZ","indices":[81,88]},{"text":"RahulBotAttack","indices":[89,104]}],"urls":[],"user_mentions":[],"symbols":[]},"favorited":false,"retweeted":false,"filter_level":"low","lang":"en"},"is_quote_status":false,"quote_count":0,"reply_count":0,"retweet_count":0,"favorite_count":0,"entities":{"hashtags":[{"text":"INDvNZ","indices":[97,104]},{"text":"RahulBotAttack","indices":[105,120]}],"urls":[],"user_mentions":[{"screen_name":"MixedRaita","name":"Ð¯Ã¸Ã¿","id":1077479862,"id_str":"1077479862","indices":[3,14]}],"symbols":[]},"favorited":false,"retweeted":false,"filter_level":"low","lang":"en","timestamp_ms":"1508728107533"};
	        });

			$scope.setBackGround = function(tweet) {
				return "background: url('" + tweet.user.profile_background_image_url_https + "') no-repeat cover";
			}

			$scope.$on('$destroy', function(){
				socketFactory.emit("closeStream", true);
			});
			
		} 
	]);

})();